---
title: "使用維護計畫精靈 | Microsoft 文件"
ms.date: 06/20/2017
ms.prod: sql-server-2016
ms.reviewer: 
ms.suite: 
ms.technology: database-engine
ms.tgt_pltfrm: 
ms.topic: article
f1_keywords:
- sql13.ag.maintwiz.integrity.f1
- sql13.ag.maintwiz.order.f1
- sql13.ag.maintwiz.report.f1
- sql13.ag.maintwiz.updatestats.f1
- sql13.ag.maintwiz.indexdefrag.f1
- sql13.ag.maintwiz.progress.f1
- sql13.ag.maintwiz.maintcleanup.f1
- sql13.ag.maintwiz.backupfull.f1
- sql13.ag.maintwiz.task.f1
- sql13.ag.maintwiz.server.f1
- sql13.ag.maintwiz.shrinkdb.f1
- sql13.ag.maintwiz.execagentjob.f1
- sql13.ag.maintwiz.summary.f1
- sql13.ag.maintwiz.welcome.f1
- sql13.ag.maintwiz.planprop.f1
- sql13.ag.maintwiz.reindex.f1
- sql13.ag.maintwiz.histcleanup.f1
- sql13.ag.maintwiz.backuplog.f1
- sql13.ag.maintwiz.backupdiff.f1
helpviewer_keywords:
- Maintenance Plan Wizard
- Database Maintenance Plan Wizard
- Database Maintenance Plan Wizard, starting
ms.assetid: db65c726-9892-480c-873b-3af29afcee44
caps.latest.revision: "43"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.workload: Active
ms.openlocfilehash: 64d2ad2fb4f75d69244ffad6e76c3cef6274309d
ms.sourcegitcommit: 9678eba3c2d3100cef408c69bcfe76df49803d63
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/09/2017
---
# <a name="use-the-maintenance-plan-wizard"></a>使用維護計畫精靈
  本主題描述如何使用 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]中的維護計畫精靈，建立單一或多部伺服器的維護計畫。 維護計畫精靈會建立可讓 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 定期執行的維護計畫。 這樣可讓您依指定間隔執行各種資料庫管理工作，包括備份、資料庫完整性檢查，或資料庫統計資料更新。  
    
 
##  <a name="Restrictions"></a> 限制事項  
  
-   若要建立多伺服器維護計畫，您必須設定多伺服器環境，其中包含一個主要伺服器以及一或多個目標伺服器。 您必須在主要伺服器上建立和維護多伺服器維護計畫。 您可以檢視目標伺服器上的計畫。   

-   **db_ssisadmin** 角色和 **dc_admin** 角色的成員可以將其權限提高為 **系統管理員**。 能夠提高權限是因為這些角色可以修改 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 封裝；這些封裝可藉由使用 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 的 **sysadmin** 安全性內容由 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行。 

若要在執行維護計畫、資料收集組和其他 [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] 封裝時預防此權限提高，請將執行封裝的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent 作業設為使用有限權限的 Proxy 帳戶，或是只將 **系統管理員** 成員加入 **db_ssisadmin** 和 **dc_admin** 角色。  

##  <a name="Prerequisite"></a> 必要條件 
您必須啟用 [Agent XPs 伺服器組態選項](../../database-engine/configure-windows/agent-xps-server-configuration-option.md)。
  
  
##  <a name="Permissions"></a> Permissions  
 若要建立或管理維護計畫，您必須是 **系統管理員 (sysadmin)** 固定伺服器角色的成員。 只有在使用者是 **sysadmin** 固定伺服器角色的成員時，[物件總管] 才會顯示 **[維護計畫]** 節點。  
  
##  <a name="SSMSProcedure"></a> 使用維護計畫精靈  
  
**啟動精靈** 

  
1.  展開要在其中建立管理計畫的伺服器。  
  
2.  展開 **[管理]** 資料夾。  
  
3.  以滑鼠右鍵按一下 [維護計畫] 資料夾，然後選取 [維護計畫精靈]。  
  
4.  在 **[SQL Server 維護計畫精靈]** 頁面上，按 **[下一步]**。  
  
5.  在 **[選取計畫屬性]** 頁面上：  
  
    1.  在 **[名稱]** 方塊中，輸入您要建立之維護計畫的名稱。  
  
    2.  在 **[描述]** 方塊中，簡要描述您的維護計畫。  
  
    3.  在 **[執行身分]** 清單中，指定 Microsoft SQL Server Agent 執行維護計畫時使用的認證。  
  
    4.  選取 **[對每一項工作個別排程]** 或 **[對整個計畫單一排程或沒有排程]** ，指定維護計畫的週期性排程。  
  
        > **注意**：如果您選取 [對每一項工作個別排程]，則需針對維護計畫中的每一項工作執行下面 **e.** 中的步驟。  
  
    5.  如果您選取 **[對整個計畫單一排程或沒有排程]**，請按一下 **[排程]**底下的 **[變更]**。  
  
        1.  在 **[新增作業排程]** 對話方塊的 **[名稱]** 方塊中，輸入作業排程的名稱。  
  
        2.  在 **[排程類型]** 清單，選取排程類型：  
  
            -   **當 SQL Server Agent 啟動時自動啟動**  
  
            -   **只要 CPU 閒置就啟動**  
  
            -   **重複執行**： 這是預設選項。  
  
            -   **一次**  
  
        3.  選取或清除 **[已停用]** 核取方塊，以啟用或停用排程。  
  
        4.  如果您選取 **[重複執行]**：  
  
            1.  在 **[頻率]**底下的 **[發生於]** 清單中，指定發生頻率：  
  
                -   如果您選取 **[每天]**，在 **[重複頻率]** 方塊中，輸入幾天重複一次作業排程的頻率。  
  
                -   如果您選取 **[每週]**，在 **[重複頻率]** 方塊中，輸入幾週重複一次作業排程的頻率。 選取一週中執行作業排程是在星期幾。  
  
                -   如果您選取 **[每月]**，可以選取 **[天]** 或 **[於]**。  
  
                    -   如果您選取 **[天]**，請輸入執行作業排程的當月日期以及幾個月重複一次作業排程的頻率。 例如，如果要在每兩個月的 15 號執行一次作業排程，請選取 **[天]** ，然後在第一個方塊中輸入 “15”，並在第二個方塊中輸入 “2”。 請注意，在最後一個方塊中允許的最大數目是 “99”。  
  
                    -   如果您選取 **[於]**，請選取執行作業排程的當月一週中特定的星期幾，以及幾個月重複一次作業排程的頻率。 例如，如果要在每兩個月的最後一個工作日執行一次作業排程，請選取 **[天]**，然後在第一個清單中選取 **[最後一個]** ，在第二個清單中選取 **[工作日]** ，然後在最後一個方塊中輸入 “2”。 您也可以在前兩個清單中選取 [第一個]、[第二個]、[第三個] 或 [第四個]，以及特定工作日 (例如星期日或星期三)。 請注意在最後一個方塊中允許的最大數目是 “99”。  
  
            2.  在 **[每日頻率]**底下，指定在執行作業排程當天重複作業排程的頻率：  
  
                -   如果您選取 **[執行一次於]**，請在 **[執行一次於]** 方塊中輸入執行作業排程的當天特定時間。 輸入時、分鐘和秒的時間，以及上午或下午。  
  
                -   如果您選取 **[重複執行於每]**，請在 **[頻率]**底下指定在所選當天執行作業排程的頻率。 例如，如果要在執行作業排程的當天每 2 個小時重複一次作業排程，請選取 [重複執行於每]，在第一個方塊中輸入 “2”，然後在清單中選取 [小時]。 您也可以從這個清單中選取 [分鐘] 和 [秒]。 請注意，在第一個方塊中允許的最大數目是 “100”。  
  
                     在 **[開始時間]** 方塊中，輸入作業排程應該開始執行的時間。 在 **[結束時間]** 方塊中，輸入作業排程應該停止重複的時間。 輸入時、分鐘和秒的時間，以及上午或下午。  
  
            3.  在 **[持續時間]**底下的 **[開始日期]**，輸入您希望作業排程開始執行的日期。 選取 **[結束日期]** 或 **[沒有結束日期]** ，以指示作業排程應該停止執行的日期。 如果您選取 **[結束日期]**，請輸入您希望作業排程停止執行的日期。  
  
        5.  如果您選取 [執行一次]，請在 [僅執行一次於] 底下的 [日期] 方塊中，輸入將要執行作業排程的日期。 在 **[時間]** 方塊中，輸入將要執行作業排程的時間。 輸入時、分鐘和秒的時間，以及上午或下午。  
  
        6.  在 **[摘要]**底下的 **[描述]**，確認所有作業排程設定是否都正確。  
  
        7.  按一下 **[確定]**。  
  
    6.  按一下 **[下一步]**。  
  
6.  在 **[選取目標伺服器]** 頁面上，選取要執行維護計畫所在的伺服器。 只有設定為主要伺服器的 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 執行個體才會顯示這個頁面。  
  
    > **注意** ：若要建立多伺服器維護計畫，必須設定多伺服器環境，其中包含一個主要伺服器以及一或多個目標伺服器，而且應將本機伺服器設為主要伺服器。 在多伺服器環境中，這個頁面會顯示 (本機) **(local)** 主要伺服器以及所有相對應的目標伺服器。  
  
7.  在 **[選取維護工作]** 頁面上，選取一個或多個要加入至計畫的維護工作。 選取所有必要的工作之後，按 **[下一步]**。  
  
    > **注意**：在這裡選取的工作，將會決定您在下面的 [選取維護工作順序] 頁面之後需要完成的頁面。  
  
8.  在 **[選取維護工作順序]** 頁面上選取一項工作，然後按一下 **[上移]** 或 **[下移]** ，即可變更其執行順序。 完成後或是您對目前的工作順序感到滿意時，按 **[下一步]**。  
  
    > **注意**：如果您在上面的 [選取計畫屬性] 頁面中選取了 [對每一項工作個別排程]，您將無法變更此頁面上維護工作的順序。  
  
## <a name="define-database-check-integrity-checkdb"></a>定義資料庫檢查完整性 (CHECKDB)  
  
 在 **[定義資料庫檢查完整性工作]** 頁面上，選擇要檢查其中使用者和系統資料表及索引之配置和結構整合性的資料庫。 藉由執行 `DBCC CHECKDB`[!INCLUDE[tsql](../../includes/tsql-md.md)] 陳述式，這項工作就可確實回報任何有關資料庫完整性的問題，以便系統管理員或資料庫擁有者稍後解決。 如需詳細資訊，請參閱 [DBCC CHECKDB &#40;TRANSACT-SQL&#41;](../../t-sql/database-console-commands/dbcc-checkdb-transact-sql.md)完成時，請按一下 [下一步]。  
  
此頁面提供下列選項。  
  
 [資料庫] 清單  
 指定受此工作影響的資料庫。  
  
 -  **所有資料庫**  
  
產生維護計畫，該計畫會對所有 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 資料庫執行此工作，但 **tempdb**除外。  
  
**系統資料庫**  
  
  - 產生維護計畫，該計畫會對 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 系統資料庫執行此工作，但 **tempdb** 和使用者建立的資料庫除外。  
  
 **所有使用者資料庫 (不包括 master、model、msdb、tempdb)**  
  
 - 產生維護計畫，針對所有使用者建立的資料庫執行此工作。 不會對 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 系統資料庫執行任何維護工作。  
  
 **下列資料庫**  
  
  - 產生維護計畫，僅針對那些已選取的資料庫執行此工作。 如果選擇此選項，則必須在清單中至少選取一個資料庫。  
  
[包含索引] 核取方塊  
 - 檢查所有的索引頁面以及資料表資料頁面的完整性。  
  
**僅限實體**  
 - 將檢查限制於頁面實體結構、記錄標頭的完整性，以及資料庫配置的一致性。 使用此選項可縮短 DBCC CHECKDB 對大型資料庫的執行階段，因此，建議您在實際系統上經常使用。  
  
**Tablock**  
 - 使 DBCC CHECKDB 取得鎖定，而不使用內部資料庫快照集。 這包括資料庫上的短期獨佔 (X) 鎖定。 使用此選項可協助 DBCC CHECKDB 在大量負載的資料庫上執行得快一些，但 DBCC CHECKDB 執行時，資料庫可用的並行處理能力會降低。  
  
## <a name="define-database-shrink-tasks"></a>定義資料庫壓縮工作  
  
1.  在 **[定義壓縮資料庫工作]** 頁面上，使用 `DBCC SHRINKDATABASE` 陳述式搭配 `NOTRUNCATE` 或 `TRUNCATEONLY` 選項建立嘗試縮減所選取資料庫大小的工作。 如需詳細資訊，請參閱 [DBCC SHRINKDATABASE &#40;Transact-SQL&#41;](../../t-sql/database-console-commands/dbcc-shrinkdatabase-transact-sql.md)。 完成後，按 **[下一步]**。  
  
    > **警告！！！！** 為壓縮檔案所移動的資料可散佈至檔案中的任何可用位置。 如此會造成索引片段，並可能導致大範圍之索引搜尋的查詢效能變慢。 若要消除資料片段，可考慮在壓縮之後重建該檔案的索引。  
  
     此頁面提供下列選項。  
  
     [資料庫] 清單  
     指定受此工作影響的資料庫。 如需有關此清單上可用選項的詳細資訊，請參閱上述步驟 9。  
  
     [當資料庫超過下列大小時則進行壓縮] 方塊  
     指定使工作執行的大小 (MB)。  
  
     [壓縮後要保持的可用空間量] 方塊  
     當資料庫檔案中的可用空間達到此大小時停止壓縮 (以百分比表示)。  
  
     **將釋放的空間保留在資料庫檔案中**  
     資料庫會壓縮至連續的分頁，但並不會取消分頁的配置，而且資料庫檔案不會壓縮。 如果您預期資料庫會再次展開，且您不希望重新配置空間，請使用此選項。 如果使用這個選項，則會儘量不壓縮資料庫檔案。 這會使用 NOTRUNCATE 選項。  
  
     **將釋放的空間交還給作業系統**  
     資料庫會緊縮至連續的分頁，且分頁會釋放給作業系統，以供其他程式使用。 這會使用 TRUNCATEONLY 選項。 這是預設選項。  
  
## <a name="define-the-index-tasks"></a>定義索引工作  
  
1.  在 [定義重新組織索引工作]On the  頁面上選取伺服器並移動其中的索引頁面，使其成為更有搜尋效率的順序。 此工作會使用 `ALTER INDEX … REORGANIZE` 陳述式。 如需詳細資訊，請參閱 [ALTER INDEX &#40;Transact-SQL&#41;](../../t-sql/statements/alter-index-transact-sql.md)。 完成後，按 **[下一步]**。  
  
     此頁面提供下列選項。  
  
     [資料庫] 清單  
     指定受此工作影響的資料庫。 如需有關此清單上可用選項的詳細資訊，請參閱上述步驟 9。  
  
     [物件] 清單  
     限制 [選取範圍] 清單僅顯示資料表或檢視，或兩者都顯示。 此清單只有在從上述 **[資料庫]** 清單選擇單一資料庫時才可使用。  
  
     [選取範圍] 清單  
     指定受此工作影響的資料表或索引。 [物件] 方塊中的 **[資料表和檢視]** 為選取狀態時無法使用。  
  
     [壓縮大型物件] 核取方塊  
     可能時取消配置給資料表和檢視的空間。 此選項使用 `ALTER INDEX … LOB_COMPACTION = ON`。  
  
2.  在 [定義重建索引工作] 頁面上，選取要在其中重新建立多個索引的資料庫。 此工作會使用 `ALTER INDEX … REBUILD PARTITION` 陳述式。 如需詳細資訊，請參閱 [ALTER INDEX &#40;Transact-SQL&#41;](../../t-sql/statements/alter-index-transact-sql.md)。)完成後，按 [下一步]。  
  
     此頁面提供下列選項。  
  
     [資料庫] 清單  
     指定受此工作影響的資料庫。 如需有關此清單上可用選項的詳細資訊，請參閱上述步驟 9。  
  
     [物件] 清單  
     限制 [選取範圍] 清單僅顯示資料表或檢視，或兩者都顯示。 此清單只有在從上述 **[資料庫]** 清單選擇單一資料庫時才可使用。  
  
     [選取範圍] 清單  
     指定受此工作影響的資料表或索引。 [物件] 方塊中的 **[資料表和檢視]** 為選取狀態時無法使用。  
  
     [可用空間選項] 區域  
     顯示將填滿因數套用至索引和資料表的選項。  
  
     **預設每頁可用空間**  
     使用預設的可用空間量重新組織頁面。 這會卸除資料庫中的資料表索引，並以建立索引時指定的填滿因數重新建立它們。 這是預設選項。  
  
     [將每頁可用空間變更為] 方塊  
     將資料庫中的資料表索引卸除，並以新的、自動計算的填滿因數重新建立它們，以在索引頁面上保留指定的可用空間。 百分比愈高，在索引頁面上保留的可用空間就愈多，而索引也愈大。 有效的數值範圍為 0 到 100。 使用 `FILLFACTOR` 選項。  
  
     [進階選項] 區域  
     顯示用於排序索引和重新索引的其他選項。  
  
     [在 tempdb 中排序結果]核取方塊  
     使用 `SORT_IN_TEMPDB` 選項，該選項會決定要暫時儲存索引建立期間所產生中繼排序結果的位置。 如果不需要排序作業，或可以在記憶體中執行排序，便會忽略 `SORT_IN_TEMPDB` 選項。  
  
     [索引頁預留空間] 核取方塊  
     使用 `PAD_INDEX` 選項。  
  
     [重新索引時，索引保留在線上] 核取方塊  
     使用 `ONLINE` 選項，此選項可讓使用者在索引作業期間存取基礎資料表或叢集索引資料，以及任何相關的非叢集索引。 選取此選項會啟動其他用於重建不允許線上重建之索引的選項： **[不要重建索引]** 和 **[離線重建索引]**。  
  
     選取此選項也會啟用 [已使用低優先順序]，其會使用 `WAIT_AT_LOW_PRIORITY` 選項。 線上索引重建作業將會等候 `MAX_DURATION` 分鐘的低優先順序鎖定，讓其他作業在線上索引建立作業等候時繼續進行。  
  
    > **注意** ： [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]的所有版本都無法使用線上索引作業。 如需詳細資訊，請參閱 [SQL Server 2016 版本支援的功能](~/sql-server/editions-and-supported-features-for-sql-server-2016.md)。  
  
     [MAXDOP] 核取方塊  
     只針對作業持續時間覆寫 DBCC CHECKDB 的 sp_configure 組態選項。 如需詳細資訊，請參閱 [DBCC CHECKDB &#40;Transact-SQL&#41;](../../t-sql/database-console-commands/dbcc-checkdb-transact-sql.md)  
  
#### <a name="define-the-update-statistics-task"></a>定義更新統計資料工作  
  
1.  在 **[定義更新統計資料工作]** 頁面上，定義要更新其中資料表和索引統計資料的資料庫。 此工作會使用 `UPDATE STATISTICS` 陳述式。 如需詳細資訊，請參閱[更新統計資料 &#40;TRANSACT-SQL&#41;](../../t-sql/statements/update-statistics-transact-sql.md) 完成時，請按一下 [下一步]  
  
     此頁面提供下列選項。  
  
     [資料庫] 清單  
     指定受此工作影響的資料庫。 如需有關此清單上可用選項的詳細資訊，請參閱上述步驟 9。  
  
     [物件] 清單  
     限制 [選取範圍] 清單僅顯示資料表或檢視，或兩者都顯示。 此清單只有在從上述 **[資料庫]** 清單選擇單一資料庫時才可使用。  
  
     [選取範圍] 清單  
     指定受此工作影響的資料表或索引。 [物件] 方塊中的 **[資料表和檢視]** 為選取狀態時無法使用。  
  
     **所有現有的統計資料**  
     同時更新資料行與索引的統計資料。  
  
     **僅限資料行統計資料**  
     僅更新資料行統計資料。 使用 `WITH COLUMNS` 選項。  
  
     **僅限索引統計資料**  
     僅更新索引統計資料。 使用 `WITH INDEX` 選項。  
  
     **掃描類型**  
     用來蒐集更新統計資料的掃描類型。  
  
     **完整掃描**  
     讀取資料表或檢視中的所有資料列來蒐集統計資料。  
  
     **取樣者**  
     當收集較大資料表或檢視的統計資料時，指定要取樣的資料表或索引檢視百分比或資料列數。  
  
#### <a name="define-the-history-cleanup-task"></a>定義記錄清除工作  
  
1.  在 **[定義記錄清除工作]** 頁面上，定義要捨棄其中舊工作記錄的資料庫。 此工作會使用 `EXEC sp_purge_jobhistory`、 `EXEC sp_maintplan_delete_log`和 `EXEC sp_delete_backuphistory` 陳述式移除 **msdb** 資料表中的記錄資訊。 完成後，請按 **[下一步]**。  
  
     此頁面提供下列選項。  
  
     **選取要刪除的記錄資料**  
     選擇要刪除的工作資料類型  
  
     **備份與還原記錄**  
     保留最近建立備份時的記錄，有助於 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 在您要還原資料庫時，建立復原計畫。 保留期限至少應該是完整資料庫備份的頻率。  
  
     **SQL Server Agent 作業記錄**  
     這個記錄可以幫助您疑難排解失敗的作業，或判斷資料庫動作為何發生。  
  
     **維護計畫記錄**  
     這個記錄可以幫助您疑難排解失敗的維護計畫作業，或判斷資料庫動作為何發生。  
  
     **移除早於下列時限的記錄資料**  
     指定您想要刪除的項目之存在時間。 您可以指定 [小時]、[天]、[週] (預設)、[月] 或 [年]  
  
#### <a name="define-the-execute-agent-job-task"></a>定義執行代理程式作業工作  
  
1.  在 **[定義執行代理程式作業工作]** 頁面的 **[可用的 SQL Server Agent 作業]**底下，選擇要執行的作業。 如果沒有 SQL Agent 作業，就無法使用此選項。 此工作會使用 `EXEC sp_start_job` 陳述式。 如需詳細資訊，請參閱 [sp_start_job &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-start-job-transact-sql.md) 完成時，請按一下 [下一步]。  
  
#### <a name="define-backup-tasks"></a>定義備份工作  
  
1.  在 [Define Backup Database (Full) Task] (定義備份資料庫 (完整) 工作) 頁面上，選取要執行完整備份的資料庫。 此工作會使用 `BACKUP DATABASE` 陳述式。 如需詳細資訊，請參閱 [BACKUP &#40;Transact-SQL&#41;](../../t-sql/statements/backup-transact-sql.md)。 完成後，請按 **[下一步]**。  
  
     此頁面提供下列選項。  
  
     [備份類型] 清單  
     顯示要執行的備份類型。 這是唯讀的。  
  
     [資料庫] 清單  
     指定受此工作影響的資料庫。 如需有關此清單上可用選項的詳細資訊，請參閱上述步驟 9。  
  
     **備份元件**  
     選取 [資料庫]，即可備份整個資料庫。 選取 **[檔案與檔案群組]** ，即可僅備份資料庫的一部分。 如果已選取，請提供檔案或檔案群組名稱。 在 **[資料庫]** 方塊中選取多個資料庫時，僅能指定 **[備份元件]** 的 **[資料庫]**。 若要執行檔案或檔案群組備份，請為每個資料庫建立工作。 這些選項只有在從上述 **[資料庫]** 清單選擇單一資料庫時才可使用。  
  
     [備份組逾期時間] 核取方塊  
     指定何時可以覆寫這個備份的備份組。 選取 **[之後]** ，然後輸入到期的天數，或選取 **[於]** ，然後輸入到期日。 如果選取 **[URL]** 做為備份目的地，則會停用這個選項。  
  
     **備份至**  
     指定要用來備份資料庫的媒體。 選取 **[磁碟]**、 **[磁帶]**或 **[URL]**。 唯有安裝在包含資料庫之電腦的磁帶裝置可以使用。  
  
     **跨越一或多個檔案備份資料庫**  
     按一下 [新增]，即可開啟 [選取備份目的地] 對話方塊。 如果選取 [URL] 做為備份目的地，則會停用這個選項。  
  
     按一下 **[移除]** ，即可從方塊中移除檔案。  
  
     按一下 **[內容]** ，即可讀取檔案標頭，並顯示檔案目前的備份內容。  
  
     [選取備份目的地] 對話方塊  
     選取檔案、磁帶機或備份裝置做為備份目的地。 如果選取 [URL] 做為備份目的地，則會停用這個選項。  
  
     [如果備份檔案存在] 清單  
     指定如何處理現有的備份。 選取 **[附加]** ，即可在檔案或磁帶中之任何現有的備份後面加入新的備份。 選取 **[覆寫]** 以移除檔案或磁帶的舊內容，並以此新的備份取代。  
  
     **為每個資料庫建立一個備份檔案**  
     在資料夾方塊裡所指定的位置中，建立備份檔案， 為選取的每個資料庫建立一個檔案。 如果選取 [URL] 做為備份目的地，則會停用這個選項。  
  
     [為每個資料庫建立一個子目錄] 核取方塊  
     根據維護計劃針對要備份的資料庫，在指定的磁碟目錄下建立一個子目錄，以放置資料庫備份。  
  
    > **重要！** 子目錄會繼承上層目錄的權限。 限制權限以避免未經授權的存取。  
  
     [資料夾] 方塊  
     指定包含自動建立的資料庫檔案的資料夾。 如果選取 [URL] 做為備份目的地，則會停用這個選項。  
  
     **SQL 認證**  
     選取用來驗證 Windows Azure 儲存體的 SQL 認證。 如果沒有現有可用的 SQL 認證，請按一下 **[建立]** 按鈕建立新的 SQL 認證。  
  
    > **重要！** 在您按一下 **[建立]** 時開啟的對話方塊需要管理憑證或訂閱的發行設定檔。 如果您無法存取管理憑證或發行設定檔，可以使用 Transact-SQL 或 SQL Server Management Studio 來指定儲存體帳戶名稱和存取金鑰資訊，藉以建立 SQL 認證。 若要使用 Transact-SQL 來建立認證，請參閱 [Create a Credential](../../relational-databases/backup-restore/sql-server-backup-to-url.md#credential) (建立認證) 主題中的範例程式碼。 或者，使用 SQL Server Management Studio，在資料庫引擎執行個體中，以滑鼠右鍵按一下 **[安全性]**、選取 **[新增]**，然後選取 **[認證]**。 針對 **[識別]** 指定儲存體帳戶名稱，並且在 **[密碼]** 欄位中指定存取金鑰。  
  
     **Azure 儲存體容器**  
     指定 Windows Azure 儲存體容器的名稱  
  
     **URL 前置詞：**  
     這會根據儲存在 SQL 認證中的儲存體帳戶資訊，以及您指定的 Azure 儲存體容器名稱自動產生。 建議您除非使用的網域採用 **\<儲存體帳戶>.blob.core.windows.net** 以外的格式，否則請勿編輯此欄位中的資訊。  
  
     [備份副檔名] 方塊  
     指定備份檔案所用的副檔名。 預設值是 .bak。  
  
     [驗證備份完整性] 核取方塊  
     確認備份組是完整的，且所有磁碟區都可以讀取。  
  
     [執行總和檢查碼] 核取方塊  
     如果已啟用備份並可供使用，則會驗證每個分頁的總和檢查碼及損毀頁，並產生整個備份的總和檢查碼。  
  
     [發生錯誤時繼續] 核取方塊  
     指示儘管發生總和檢查碼無效或損毀頁之類的錯誤，BACKUP 仍繼續作業。  
  
     **備份加密**  
     若要建立加密的備份，請核取 [加密備份] 核取方塊。 選取要加密步驟所要使用的加密演算法，並提供現有憑證或非對稱金鑰清單中的憑證或非對稱金鑰。 可用於加密的演算法包括：  
  
    -   AES 128  
  
    -   AES 192  
  
    -   AES 256  
  
    -   Triple DES  
  
     如果選擇附加至現有的備份集，則會停用加密選項。  
  
     這建議作法是讓您備份憑證或金鑰，並將其儲存在不同位置，而不是加密備份。  
  
     僅支援位於可延伸金鑰管理 (EKM) 中的金鑰。  
  
     [區塊大小] 核取方塊與清單  
  
     指定實體區塊大小 (以位元組為單位)。 一般而言，只有在寫入磁帶裝置、RAID 陣列或 SAN 時，這個選項才會對效能造成影響。  
  
     [傳輸大小上限] 核取方塊與清單  
  
     以位元組為單位，指定要用於 SQL Server 和備份媒體之間的最大傳送單位。  
  
     **[設定備份壓縮]** 清單  
     在 [!INCLUDE[ssEnterpriseEd10](../../includes/ssenterpriseed10-md.md)] (或更新的版本) 中，選取下列其中一個 [備份壓縮](../../relational-databases/backup-restore/backup-compression-sql-server.md) 值：  
  
    |||  
    |-|-|  
    |**使用預設伺服器設定**|按一下即可使用伺服器層級的預設值。 此預設值是由 [備份壓縮預設] 伺服器組態選項所設定。 有關如何檢視這個選項目前之設定的詳細資訊，請參閱 [檢視或設定備份壓縮預設伺服器組態選項](../../database-engine/configure-windows/view-or-configure-the-backup-compression-default-server-configuration-option.md)。|  
    |**壓縮備份**|不論目前的伺服器層級預設值為何，按一下即可壓縮備份。<br /><br /> **\*\* 重要 \*\*** 根據預設，壓縮會大幅增加 CPU 使用量，而且壓縮程序所耗用的額外 CPU 可能會對並行作業造成不良的影響。 因此，您可能會想要在資源管理員限制 CPU 使用量的工作階段中建立低優先權的壓縮備份。 如需詳細資訊，請參閱本主題稍後介紹的＜ [使用資源管理員進行備份壓縮，以限制 CPU 使用率 &#40;Transact-SQL&#41;](../../relational-databases/backup-restore/use-resource-governor-to-limit-cpu-usage-by-backup-compression-transact-sql.md)限制的工作階段中，建立低優先權的壓縮備份。|  
    |**不要壓縮備份**|不論目前的伺服器層級預設值為何，按一下即可建立未壓縮備份。|  
  
2.  在 [Define Backup Database (Differential) Task (定義備份資料庫 (差異式) 工作)] 頁面上，選取要執行部分備份的資料庫。 如需有關此頁面上可用選項的詳細資訊，請參閱上述步驟 16 中的定義清單。 此工作會使用 `BACKUP DATABASE … WITH DIFFERENTIAL` 陳述式。 如需詳細資訊，請參閱 [BACKUP &#40;Transact-SQL&#41;](../../t-sql/statements/backup-transact-sql.md)。  完成後，請按 **[下一步]**。  
  
3.  在 [Define Backup Database (Transaction Log) Task (定義備份資料庫 (交易記錄) 工作)] 頁面上，選取要執行交易記錄備份的資料庫。 如需有關此頁面上可用選項的詳細資訊，請參閱上述步驟 16 中的定義清單。 此工作會使用 `BACKUP LOG` 陳述式。 如需詳細資訊，請參閱 [BACKUP &#40;Transact-SQL&#41;](../../t-sql/statements/backup-transact-sql.md)。 完成後，請按 **[下一步]**。  
  
#### <a name="define-maintenance-cleanup-tasks"></a>定義維護清除工作  
  
1.  在 **[定義維護清除工作]** 頁面上，指定維護計畫中要刪除的檔案類型，包括維護計畫和資料庫備份檔案所建立的文字報表。 此工作會使用 `EXEC xp_delete_file` 陳述式。 完成後，請按 **[下一步]**。  
  
    > **重要！！** 此工作不會自動刪除所指定目錄的子資料夾中的檔案。 這項預防措施可降低利用「維護清除」工作刪除檔案這類惡意攻擊的可能性。 如果您要刪除第一層子資料夾中的檔案，必須選取 [包含第一層的子資料夾]。  
  
     此頁面提供下列選項。  
  
     **刪除下列類型的檔案**  
     指定要刪除的檔案類型。  
  
     **備份檔案**  
     刪除資料庫備份檔案。  
  
     **維護計畫文字報表**  
     刪除先前執行之維護計畫的文字報表。  
  
     **檔案位置**  
     指定要刪除之檔案的路徑。  
  
     **刪除特定檔案**  
     刪除 [檔案名稱] 文字方塊中提供的特定檔案。  
  
     **根據副檔名搜尋資料夾並刪除檔案**  
     刪除指定之資料夾中具有指定之副檔名的所有檔案。 使用此方法即可同時刪除多個檔案，例如 Tuesday 資料夾中副檔名為 .bak 的所有備份檔案。  
  
     [資料夾] 方塊  
     包含要刪除檔案的資料夾路徑與名稱。  
  
     [副檔名] 方塊  
     提供要刪除的檔案副檔名。 若要同時刪除多個檔案，像是 Tuesday 資料夾中副檔名為 .bak 的所有備份檔案，請指定 .bak。  
  
     [包含第一層的子資料夾] 核取方塊  
     從 [資料夾] 所指定資料夾底下的第一層子資料夾中，刪除具有 [副檔名] 中所指定之副檔名的檔案。  
  
     在工作執行階段依據檔案存在時間刪除檔案 核取方塊  
     在 [刪除早於下列時限的檔案] 方塊中提供數字以及時間單位，以指定您要刪除之檔案的最低存在時間。  
  
     **刪除早於下列時限的檔案**  
     提供數字以及時間單位 ([小時]、[日]、[週]、[月] 或 [年])，指定要刪除之檔案的最低存在時間。 存在時間超過指定時間的檔案會遭到刪除。  
  
#### <a name="select-report-options"></a>選取報表選項  
  
1.  在 **[選取報表選項]** 頁面上，選取儲存或散發維護計畫動作報表的選項。 此工作會使用 `EXEC sp_notify_operator` 陳述式。 如需詳細資訊，請參閱 [sp_notify_operator &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-notify-operator-transact-sql.md) 完成時，請按一下 [下一步]。  
  
     此頁面提供下列選項。  
  
     [將報表寫入文字檔] 核取方塊  
     在檔案中儲存報表。  
  
     [資料夾位置] 方塊  
     指定包含報表的檔案位置。  
  
     [以電子郵件傳送報表] 核取方塊  
     工作失敗時傳送電子郵件。 若要使用這個工作，您必須先啟用 Database Mail，並正確設定 MSDB 作為郵件主機資料庫，同時擁有具有效電子郵件地址的 [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 代理程式操作員。  
  
     **代理程式操作員**  
     指定電子郵件的收件者。  
  
     **郵件設定檔**  
     指定定義電子郵件寄件者的設定檔。  
  
#### <a name="complete-the-wizard"></a>完成精靈  
  
1.  在 **[完成精靈]** 頁面上，確認之前所有頁面上的選擇，然後按一下 **[完成]**。  
  
2.  在 **[維護精靈進度]** 頁面上，監視有關維護計畫精靈之動作的狀態資訊。 根據您在精靈中選取的選項，[進度] 頁面可能會包含一個或多個動作。 頂端的方塊會顯示精靈的整體狀態以及精靈已接收的狀態、錯誤和警告訊息數。  
  
     **[維護精靈進度]** 頁面上提供下列選項：  
  
     **詳細資料**  
     提供從精靈所採取的動作傳回的動作、狀態和任何訊息。  
  
     **動作**  
     指定每個動作的類型和名稱。  
  
     **狀態**  
     指出整個精靈動作傳回 [成功] 或 [失敗] 的值。  
  
     **訊息**  
     提供從程序所傳回的任何錯誤或警告訊息。  
  
     **報表**  
     建立包含 [建立分割區精靈] 結果的報表。 選項為 **[檢視報表]**、 **[將報表儲存到檔案]**、 **[複製報表到剪貼簿]**和 **[以電子郵件傳送報表]**。  
  
     **檢視報表**  
     開啟 [檢視報表] 對話方塊，其中包含 [建立分割區精靈] 進度的文字報表。  
  
     **將報表儲存到檔案**  
     開啟 [另存報表] 對話方塊。  
  
     **複製報表到剪貼簿**  
     將精靈進度報表的結果複製到剪貼簿。  
  
     **[以電子郵件傳送報表]**  
     將精靈進度報表的結果複製到電子郵件。  
  
  

