---
title: SQL Server R Services 效能微調-SQL Server Machine Learning 服務
ms.prod: sql
ms.technology: machine-learning
ms.date: 04/15/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
manager: cgronlun
ms.openlocfilehash: e547e2cd3c50e020d1164dc2b8aaffb31f4e3cb8
ms.sourcegitcommit: 2827d19393c8060eafac18db3155a9bd230df423
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/27/2019
ms.locfileid: "58510105"
---
# <a name="performance-tuning-for-r-in-sql-server"></a>SQL Server 中的 R 效能微調
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

這篇文章是一系列四篇文章描述的兩個案例研究為基礎的 R 服務的效能最佳化的第一個：

- 產品開發團隊，以驗證 R 解決方案的效能設定檔進行的效能測試

- 是 Microsoft 資料科學小組通常客戶所要求的特定機器學習案例的效能最佳化。

這個系列的目標是提供相關的各種效能微調最適合用來在 SQL Server 中執行 R 作業的技術指引。

+ 針對資料科學工作進行最佳化時，此 （第一個） 的主題會提供架構的概觀以及一些常見的問題。
+ 第二篇文章涵蓋特定的硬體和 SQL Server 最佳化。
+ 第三篇文章涵蓋最佳化 R 程式碼和運算化的資源。
+ 第四個的文章會說明詳細資料，並報告與洞見及需要結論的測試方法。

**適用於：** SQL Server 2016 R Services、 SQL Server 2017 Machine Learning 服務

## <a name="performance-goals-and-targeted-scenarios"></a>效能目標和目標的案例

SQL server，以支援執行 R 指令碼的 SQL Server 2016 中引進的 R Services 功能。 當您使用這項功能時，R 執行階段會在不同的處理序，從資料庫引擎，可運作，但與 database engine、 SQL Server，例如受信任的 Launchpad 使用伺服器資源與互動的服務安全地交換資料。

在 SQL Server 2017 中，發表了執行 Python 指令碼使用相同的架構，以進行未來的其他語言支援。

支援的版本和語言的數目增加時，很重要的資料庫管理員和資料庫架構設計人員會留意 machine learning 作業，因為資源競爭的可能性，他們就能夠將伺服器設定成支援新的工作負載。 雖然讓分析貼近資料，就會消除不安全的資料移動，它也會移動的資料科學家和回裝載資料的伺服器上的膝上型電腦關閉的分析工作負載。

機器學習服務的效能最佳化不清楚一體適用的主張。 下列的一般工作可能會有非常不同的效能設定檔：

- 定型集工作： 建立和定型集和定型類神經網路迴歸模型
- 使用 T-SQL 的功能擷取與使用 R 的特徵工程設計
- 在單一資料列或與評分使用表格式輸入大量的小型批次評分
- 執行與將模型部署到 SQL Server 的生產環境，預存程序中 R 的評分
- 修改 R 程式碼，以減少資料傳輸，或移除昂貴的資料轉換
- 啟用自動化的測試和重新定型的模型

因為最佳化技術的選擇取決於哪一個工作是很重要的應用程式或使用案例，案例研究涵蓋一般效能提示，以及如何最佳化特定案例中，批次評分的最佳化指引。

+ **SQL Server 中的個別的最佳化選項**

    在第一次的效能案例研究中，使用一種模型類型的單一資料集上執行多個測試。 RxLinMod RevoscaleR 中所使用演算法來建立模型，並透過它所建立的分數，但是程式碼為基礎的資料表已有系統地更改來測試每個變更的影響。

    比方說，在一個測試回合中，R 程式碼已改變，所以無法使用預先計算的功能，，然後再載入資料表中的 功能與轉換函式的特徵工程設計之間進行比較。 在另一個測試回合中，模型訓練效能已使用各種類型的壓縮或新的索引類型的資料表中的標準索引的資料表與資料之間比較。

+ **為特定的高容量評分的案例最佳化**

    機器學習工作，在第二個案例研究中的牽涉到處理許多繼續提交以供多個位置，並尋找每個工作位置的最佳候選項目。 機器學習服務模型本身會依構成為二進位分類問題： 它會繼續與工作的描述，做為輸入，並產生每個繼續作業組的機率。 目標是要尋找最符合項目，因為使用者定義的機率臨界值用來進一步篩選，以及取得只是很好的相符項目中。

    針對此解決方案的主要目標是在評分期間達到低延遲。 不過，這項工作是耗費許多資源，甚至在計分過程中，因為每個新的工作必須符合數以百萬計的合理的時間範圍內的履歷表。 此外，在功能工程步驟會產生超過 2000年的功能，每個 繼續 或 作業，而且是顯著的效能瓶頸。

我們建議您檢閱的第一個案例研究，以判斷哪一個技術是以您的解決方案，適用於所有結果，並評估其潛在的影響。

接著，檢閱計分的最佳化案例研究，以了解作者如何套用不同的技術及最佳化伺服器以支援特定的工作負載的結果。

## <a name="performance-optimization-process"></a>效能最佳化程序

組態和微調效能，必須建立穩固的基礎，要針對特定工作負載所設計的圖層最佳化：

- 選擇適當的伺服器與主機 analytics。 一般而言，次要報告、 資料倉儲或其他已用於其他報告或分析的伺服器是慣用的。 不過，在混合式交易式分析處理 (HTAP) 解決方案中，作業資料可以用於做為 R 的輸入快速評分。

- SQL Server 執行個體設定為平衡資料庫引擎的作業和 R 或 Python 指令碼執行適當的層級。 這可能包括變更記憶體及 CPU 使用量、 NUMA 和處理器親和性設定，並建立資源群組的 SQL Server 預設值。

- 最佳化的伺服器電腦，以支援有效率地使用外部指令碼。 這可以包括外部指令碼執行，請啟用封裝管理所使用的帳戶數目增加，並將使用者指派至相關的安全性角色。

- 套用特定的最佳化資料的儲存體和 SQL Server，包括編製索引和統計資料的策略，查詢設計和查詢最佳化的資料表所使用的機器學習的設計中的傳輸。 您也可以分析資料來源和資料傳輸方法，或修改 ETL 程序，以最佳化擷取特徵。

- 微調分析模型，以避免效率不足的情況。 也有可能的最佳化的範圍取決於您的 R 程式碼和套件以及您使用的資料的複雜性。 主要工作包括減少昂貴的資料轉換或卸載資料準備 」 或 「 功能工程工作從 R 或 Python ETL 程序或 SQL。 您也可能重構指令碼、 排除在列中的套件會安裝、 將 R 程式碼分割成訓練、 評分和評估的個別程序或簡化程式碼，以做為預存程序更有效率地運作。

## <a name="articles-in-this-series"></a>在這一系列的文章

+ [SQL Server-硬體中的 R 效能微調](../r/sql-server-configuration-r-services.md)

    提供設定硬體的指引，[!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)]上所安裝，以及設定 SQL Server 執行個體，可更妥善支援外部指令碼。 這特別適合用於**資料庫管理員**。

+ [在 SQL Server-程式碼和資料的 R 效能微調最佳化](../r/r-and-data-optimization-r-services.md)

    提供特定的秘訣，如何最佳化外部指令碼，以避免發生已知的問題。 若要最有用**資料科學家**。

    > [!NOTE]
    > 雖然大部分的這一節適用於 R 一般情況下，某些資訊是資訊的以特定 RevoScaleR 分析函數。 詳細的效能指引不適用於**revoscalepy**和其他支援的 Python 程式庫。
    >

+ [SQL Server-方法和結果中的 R 效能微調](../r/performance-case-study-r-services.md)

    摘要說明哪些資料是使用兩個案例研究、 如何已測試的效能，以及如何最佳化會影響結果。
