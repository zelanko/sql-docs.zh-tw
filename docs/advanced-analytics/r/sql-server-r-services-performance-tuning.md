---
title: SQL Server R Services 效能微調 | Microsoft Docs
ms.prod: sql
ms.technology: machine-learning
ms.date: 04/15/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: 974e4ab2a33e7cc218c22246f7279a131893f119
ms.sourcegitcommit: 7a6df3fd5bea9282ecdeffa94d13ea1da6def80a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/16/2018
ms.locfileid: "31203120"
---
# <a name="performance-tuning-for-r-in-sql-server"></a>SQL Server 中 R 的效能微調
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

本文是一系列的說明效能最佳化，針對 R 服務，根據兩個案例研究的四個文件中的第一個：

- 產品開發團隊，以驗證 R 解決方案的效能設定檔所進行的效能測試

- 是 Microsoft 資料科學小組通常客戶所要求的特定機器學習案例的效能最佳化。

這一系列的目標是效能的提供下列類型微調技術是效能的最適用於 SQL Server 中執行 R 工作的相關指引。

+ 最佳化資料科學工作時，本 （第一） 的主題將提供的架構，以及一些常見的問題的概觀。
+ 第二個本文件涵蓋特定的硬體和 SQL Server 最佳化。
+ 第三個本文件涵蓋最佳化在 R 程式碼和實施的資源。
+ 第四個發行項描述中的詳細資料，並報告結果結論的測試方法。

**適用於：** SQL Server 2016 R Services、 SQL Server 2017 機器學習服務

## <a name="performance-goals-and-targeted-scenarios"></a>效能目標和目標的案例

SQL server，以支援執行 R 指令碼的 SQL Server 2016 中引進 R 服務功能。 當您使用這項功能時，R 執行階段在 database engine，不同的處理序中運作，但與 database engine、 SQL Server，例如 [受信任的啟動列] 中使用伺服器資源與服務互動的安全地交換資料。

在 SQL Server 2017，已宣布執行 Python 指令碼使用相同的架構，與其他語言進行未來的支援。

支援的版本和語言的數目增加時，它很重要的資料庫管理員和資料庫架構設計人員了解潛在的機器學習工作，因為資源爭用和，它們都能設定伺服器以支援新的工作負載。 雖然保持資料分析會排除不安全的資料移動，也會移動關閉的膝上型電腦的資料科學家和回伺服器主控資料分析工作負載。

機器學習的效能最佳化不清楚一體主張。 下列的一般工作可能會有非常不同的效能設定檔：

- 訓練工作： 建立和定型集和定型類神經網路迴歸模型
- 使用 R 與使用 T-SQL 擷取特徵的特徵設計
- 在單一資料列或小型批次計分使用表格式輸入大量與計分
- 執行計分 R 中與模型部署到 SQL Server 上的實際執行環境，預存程序
- 修改 R 程式碼，以降低資料傳輸，或移除最密切相關的資料轉換
- 啟用自動化的測試和定型的模型

因為最佳化技術的選擇取決於哪一項工作是關鍵應用程式或使用案例、 案例研究涵蓋一般效能提示，以及如何為特定案例最佳化的批次計分最佳化指引。

+ **SQL Server 中的個別的最佳化選項**

    在第一次的效能案例研究，使用單一類型的模型為單一資料集上執行了多個測試。 RevoscaleR rxLinMod 演算法用來建立模型，並建立分數，但該程式碼為基礎的資料表有系統地遭變更來測試每個變更的影響。

    例如，一個測試回合中，使其無法使用預先計算的功能，然後再載入資料表中的 功能與轉換函式的特徵設計之間進行比較已變更的 R 程式碼。 在另一個測試回合中，模型的培訓成效已比較使用標準索引的資料表與資料中包含各種類型的壓縮或新的索引類型的資料表之間。

+ **為特定的大量的計分的案例最佳化**

    機器學習工作，在第二個案例研究包含處理許多繼續提交多個位置，並尋找每個工作位置的最佳候選項目。 機器學習模型本身二元分類問題構成： 它會繼續和工作的描述，做為輸入，並產生每個恢復作業組的機率。 目標是要尋找最佳的相符項目，因為使用者定義的機率臨界值用來進一步篩選並取得只理想的相符項目。

    針對此解決方案，主要目標已達成低延遲期間計分。 不過，這項工作是即使在計分過程中，高度耗費計算能力，因為每個新的工作必須比對包含數百萬個合理的時間範圍內的履歷表。 此外，在功能工程步驟會產生每個 繼續 或 工作，超過 2000年功能，而且是顯著的效能瓶頸。

我們建議您檢閱的第一個案例研究，以判斷哪個技術適用於您的方案，所有結果並衡量其潛在影響。

接著，檢閱計分最佳化個案研究，作者如何套用不同的技術，以及最佳化伺服器以支援特定的工作負載的結果。

## <a name="performance-optimization-process"></a>效能最佳化程序

組態和微調效能也需要建立為實線基底，要針對特定工作負載所設計的分層最佳化：

- 選擇適當的伺服器至主機分析。 一般而言，次要報告、 資料倉儲或其他伺服器已用於其他報告或分析是慣用的。 不過，在混合式交易分析處理 (HTAP) 解決方案中，操作資料可以用於做為 R 的輸入快速計分。

- 設定 SQL Server 執行個體，以平衡資料庫引擎作業，而 R 或 Python 指令碼在適當的層級的執行。 這可能包括變更 SQL Server 的記憶體和 CPU 使用量、 NUMA 和處理器親和性設定，以及建立資源群組的預設值。

- 最佳化伺服器電腦，以支援有效率地使用的外部指令碼。 這可以包括使用外部指令碼執行，請啟用封裝管理帳戶的數目增加，以及將使用者指派至相關的安全性角色。

- 將特定的最佳化套用至資料儲存和傳輸 SQL Server，包括索引和統計資料的策略，查詢設計及查詢最佳化資料表所使用的機器學習的設計。 您可能也會分析資料來源和資料傳輸方法，或是修改 ETL 處理序，以最佳化擷取特徵。

- 微調分析的模型，以避免無效率。 最佳化可能會有的範圍取決於您的 R 程式碼的封裝和您使用的資料的複雜性。 主要工作包括減少昂貴的資料轉換或卸載資料準備工作或功能工程工作從 R 或 Python ETL 處理序或 SQL。 您也可能重構指令碼、 消除內嵌封裝會安裝、 將 R 程式碼分割成不同的程序進行訓練、 計分，和評估，或簡化程式碼，以做為預存程序更有效率地運作。

## <a name="articles-in-this-series"></a>在這一系列的文章

+ [SQL Server-硬體中的 R 的效能微調](..\r\sql-server-configuration-r-services.md)

    提供指導方針設定硬體， [!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md)]已安裝，而且可用於設定 SQL Server 執行個體，可更妥善支援外部指令碼。 它特別適用於**資料庫管理員**。

+ [SQL Server-程式碼和資料中的 R 的效能微調最佳化](..\r\r-and-data-optimization-r-services.md)

    提供特定如何最佳化外部指令碼，以避免發生已知的問題的秘訣。 它是最有用**資料科學家**。

    [!NOTE]
    > 雖然大部分的這一節適用於 R 一般情況下，部分資訊是資訊的特有 RevoScaleR 分析函數。 詳細的效能指引不適用於**revoscalepy**和其他支援 Python 程式庫。

+ [SQL Server-方法和結果中的 R 的效能微調](..\r\performance-case-study-r-services.md)

    摘要說明哪些資料是使用兩個案例研究、 如何已測試的效能，以及如何最佳化會影響結果。
